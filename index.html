<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Whack-a-CC — 1分ランキング（サウンド付き）</title>
  <style>
    :root { --cols:3; --rows:3; --hole:26vw; --gap:3vw; --radius:2.2vw; }
    html,body { margin:0; height:100%; background:#0e0e10; color:#fff; font-family: system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Noto Sans JP",sans-serif; overflow:hidden; overscroll-behavior:none; touch-action:none; }
    .wrap { height:100dvh; width:100vw; display:flex; flex-direction:column; align-items:center; box-sizing:border-box; padding:8px 10px; gap:8px; }
    .header { width:100%; display:flex; gap:2vw; align-items:center; justify-content:space-between; }
    .brand { font-weight:800; font-size:4.4vw; }
    .stats { display:flex; gap:2vw; }
    .badge { background:#1b1b1f; border:1px solid #2a2a33; padding:.9vw 1.6vw; border-radius:999px; font-size:3.6vw; min-width:16vw; text-align:center; }
    .combo { background:#26223a; border:1px solid #3b2f6d; }
    .controls { display:flex; gap:2vw; }
    button { border:none; border-radius:3vw; padding:1.8vw 2.6vw; background:#2b2b33; color:#fff; font-weight:700; font-size:3.6vw; }
    button:active { transform:translateY(1px); }
    .main { flex:1; display:flex; justify-content:center; align-items:center; }
    .board { width:calc(var(--cols)*var(--hole)+(var(--cols)-1)*var(--gap)); height:calc(var(--rows)*var(--hole)+(var(--rows)-1)*var(--gap)); display:grid; grid-template-columns:repeat(var(--cols),var(--hole)); grid-template-rows:repeat(var(--rows),var(--hole)); gap:var(--gap); }
    .hole { position:relative; background: radial-gradient(ellipse at center,#15151a 0%,#0f0f12 70%,#07070a 100%); border-radius:calc(var(--radius)+4px); overflow:hidden; }
    .target { position:absolute; inset:auto 0 0 0; margin:auto; width:88%; aspect-ratio:1/1; transform:translateY(110%); transition:.18s; border-radius:12px; pointer-events:auto; }
    .target.up { transform:translateY(0); }
    .target.hit { filter:brightness(.8) grayscale(.2); }
    .float { position:absolute; left:50%; top:30%; transform:translateX(-50%); font-weight:900; font-size:5vw; text-shadow:0 2px 6px rgba(0,0,0,.6); opacity:0; }
    .footer { width:100%; display:flex; justify-content:space-between; align-items:center; font-size:3.2vw; }
    .overlay { position:fixed; inset:0; background:rgba(0,0,0,.6); display:none; align-items:center; justify-content:center; z-index:1000; }
    .modal { background:#121219; border:1px solid #2a2a33; border-radius:16px; padding:18px; }
    .celebrate { position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:1100; }
  </style>
</head>
<body>
<div class="wrap">
  <header class="header">
    <div class="brand">Whack-a-CC</div>
    <div class="stats">
      <div class="badge">Score <span id="score">0</span></div>
      <div class="badge">Time <span id="time">60</span>s</div>
      <div class="badge combo">Combo <span id="combo">0</span></div>
    </div>
    <div class="controls">
      <button id="startBtn">スタート</button>
      <button id="lbBtn">ランキング</button>
    </div>
  </header>
  <main class="main">
    <div class="board" id="board"></div>
  </main>
  <footer class="footer">CC.png:加点 ／ NN.png:-50点＆コンボ0</footer>
</div>

<audio id="smashAudio" src="smash.mp3" preload="auto"></audio>
<audio id="noAudio" src="no.mp3" preload="auto"></audio>
<audio id="bgmAudio" src="BGM.mp3" preload="auto" loop></audio>
<audio id="congAudio" src="cong.mp3" preload="auto"></audio>

<script>
(function(){
  const board=document.getElementById('board');
  const scoreEl=document.getElementById('score');
  const timeEl=document.getElementById('time');
  const comboEl=document.getElementById('combo');
  const startBtn=document.getElementById('startBtn');
  const smashAudio=document.getElementById('smashAudio');
  const noAudio=document.getElementById('noAudio');
  const bgmAudio=document.getElementById('bgmAudio');

  const IMG_CC='CC.png'; const IMG_NN='NN.png';
  let score=0,combo=0,timeLeft=60,timerId,spawnTimer,running=false;

  function buildBoard(){
    board.innerHTML='';
    for(let i=0;i<9;i++){
      const hole=document.createElement('div'); hole.className='hole';
      const img=document.createElement('img'); img.className='target';
      img.addEventListener('pointerdown',onHit);
      hole.appendChild(img);
      const fl=document.createElement('div'); fl.className='float'; hole.appendChild(fl);
      board.appendChild(hole);
    }
  }

  function setScore(v){ score=v; scoreEl.textContent=v; }
  function setCombo(v){ combo=v; comboEl.textContent=v; }

  function start(){ if(running) return; running=true; score=0; combo=0; timeLeft=60; setScore(0); setCombo(0); timeEl.textContent=timeLeft; startBtn.disabled=true; bgmAudio.currentTime=0; bgmAudio.play().catch(()=>{}); runTimer(); spawn(); }

  function runTimer(){ clearInterval(timerId); timerId=setInterval(()=>{ timeLeft--; timeEl.textContent=timeLeft; if(timeLeft<=0){ clearInterval(timerId); endGame(); } },1000); }

  function spawn(){ clearInterval(spawnTimer); spawnTimer=setInterval(()=>{
    const holes=[...document.querySelectorAll('.hole')];
    const hole=holes[Math.floor(Math.random()*holes.length)];
    const img=hole.querySelector('.target');
    const isNN=Math.random()<0.2;
    img.src=isNN?IMG_NN:IMG_CC; img.dataset.kind=isNN?'nn':'cc';
    img.classList.add('up');
    setTimeout(()=>{ img.classList.remove('up'); },700);
  },800); }

  function onHit(e){
    if(!running) return;
    const img=e.currentTarget; if(!img.classList.contains('up')) return;
    img.classList.remove('up');
    if(img.dataset.kind==='cc'){ combo++; score+=combo; smashAudio.currentTime=0; smashAudio.play().catch(()=>{}); }
    else { combo=0; score-=50; noAudio.currentTime=0; noAudio.play().catch(()=>{}); }
    setScore(score); setCombo(combo);
  }

  function endGame(){ running=false; clearInterval(spawnTimer); bgmAudio.pause(); startBtn.disabled=false; }

  buildBoard();
  startBtn.addEventListener('click',start);
})();
</script>
</body>
</html>
